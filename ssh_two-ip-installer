#!/bin/bash

CONFIG_FILE="/etc/two_ip.conf"

# ================== COLORS ==================
RED='\033[1;31m'
GREEN='\033[1;32m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
CYAN='\033[1;36m'
NC='\033[0m'

clear
echo -e "${CYAN}==============================================${NC}"
echo -e "${GREEN}        SSH-TWO Management Menu        üöÄ${NC}"
echo -e "${CYAN}==============================================${NC}"
echo ""

while true; do
    echo -e "${YELLOW}1.${NC} Re-run Installation"
    echo -e "${YELLOW}2.${NC} Edit Config File (/etc/two_ip.conf)"
    echo -e "${YELLOW}3.${NC} Exit"
    echo -ne "${BLUE}Choose an option: ${NC}"
    read CHOICE

    case $CHOICE in
        1)
            echo -e "${GREEN}üöÄ Running Installation Script...${NC}"
            # ŸÅÿ±ÿßÿÆŸàÿßŸÜ€å ÿßÿ≥⁄©ÿ±€åŸæÿ™ ŸÜÿµÿ® ÿßÿµŸÑ€å
            bash <(curl -Ls https://raw.githubusercontent.com/aliflash0098/ssh-two-ip-installer/main/install.sh)
            ;;
        2)
            if [ ! -f "$CONFIG_FILE" ]; then
                echo -e "${RED}Config file not found!${NC}"
                sleep 2
                continue
            fi

            echo -e "${GREEN}Editing Config File...${NC}"
            echo -e "${CYAN}Press Enter to keep the current value for each option${NC}"

            # ÿÆŸàÿßŸÜÿØŸÜ ŸÖŸÇÿØÿßÿ± ŸÇÿ®ŸÑ€å
            source $CONFIG_FILE

            # Ÿà€åÿ±ÿß€åÿ¥ ÿ™ÿπÿßŸÖŸÑ€å ŸÖŸÇÿßÿØ€åÿ±
            read -p "Primary IP [$PRIMARY_IP]: " TMP
            PRIMARY_IP=${TMP:-$PRIMARY_IP}

            read -p "Secondary IP [$SECONDARY_IP]: " TMP
            SECONDARY_IP=${TMP:-$SECONDARY_IP}

            read -p "SSH Port [$SSH_PORT]: " TMP
            SSH_PORT=${TMP:-$SSH_PORT}

            read -p "Local Port [$PORT_LOCAL]: " TMP
            PORT_LOCAL=${TMP:-$PORT_LOCAL}

            read -p "Remote Port [$PORT_REMOTE]: " TMP
            PORT_REMOTE=${TMP:-$PORT_REMOTE}

            # ÿ∞ÿÆ€åÿ±Ÿá ÿ™ÿ∫€å€åÿ±ÿßÿ™
            cat > $CONFIG_FILE <<EOF
PRIMARY_IP="$PRIMARY_IP"
SECONDARY_IP="$SECONDARY_IP"
PORT_LOCAL="$PORT_LOCAL"
PORT_REMOTE="$PORT_REMOTE"
SSH_PORT="$SSH_PORT"
MAX_RETRY=2
EOF

            echo -e "${GREEN}‚úî Config updated successfully!${NC}"
            ;;
        3)
            echo -e "${GREEN}Exiting Menu. Bye! üëã${NC}"
            exit 0
            ;;
        *)
            echo -e "${RED}Invalid option. Try again.${NC}"
            ;;
    esac
done
